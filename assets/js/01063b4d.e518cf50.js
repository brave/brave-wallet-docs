"use strict";(self.webpackChunkbrave_wallet_docs=self.webpackChunkbrave_wallet_docs||[]).push([[323],{5311:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"provider-availability","title":"Restrictions for providers","description":"The provider objects (e.g. window.ethereum and window.braveSolana) are not provided in all contexts.","source":"@site/docs/provider-availability.md","sourceDirName":".","slug":"/provider-availability","permalink":"/provider-availability","draft":false,"unlisted":false,"editUrl":"https://github.com/brave/brave-wallet-docs/edit/main/docs/provider-availability.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Provider objects","permalink":"/provider-objects"},"next":{"title":"Default Wallet setting","permalink":"/default-wallet"}}');var r=s(4848),n=s(8453);const t={sidebar_position:3},c="Restrictions for providers",l={},d=[{value:"Restrictions for insecure contexts",id:"restrictions-for-insecure-contexts",level:2},{value:"Restrictions in iframes",id:"restrictions-in-iframes",level:2},{value:"iOS",id:"ios",level:3},{value:"Example cases",id:"example-cases",level:2}];function a(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"restrictions-for-providers",children:"Restrictions for providers"})}),"\n",(0,r.jsxs)(i.p,{children:["The provider objects (e.g. ",(0,r.jsx)(i.code,{children:"window.ethereum"})," and ",(0,r.jsx)(i.code,{children:"window.braveSolana"}),") are not provided in all contexts."]}),"\n",(0,r.jsxs)(i.p,{children:['Historically the web has had a notion of \u201cpowerful" APIs like geolocation and camera/microphone, which are subject to additional security restrictions. See for instance ',(0,r.jsx)(i.a,{href:"https://www.w3.org/TR/secure-contexts/",children:"https://www.w3.org/TR/secure-contexts/"}),"."]}),"\n",(0,r.jsxs)(i.p,{children:["Because they allow websites to request access to user funds, new web3 APIs like ",(0,r.jsx)(i.code,{children:"window.ethereum"})," and ",(0,r.jsx)(i.code,{children:"window.braveSolana"})," are subject to the same restrictions as other powerful APIs like ",(0,r.jsx)(i.code,{children:"geolocation"})," in Brave.\nAs a rule of thumb, if a context is not allowed to request access to geolocation, ",(0,r.jsx)(i.code,{children:"window.ethereum"})," and ",(0,r.jsx)(i.code,{children:"window.braveSolana"})," are ",(0,r.jsx)(i.code,{children:"undefined"})," in the same contexts."]}),"\n",(0,r.jsx)(i.p,{children:"Provider objects are not accessible in private and Tor window."}),"\n",(0,r.jsx)(i.h2,{id:"restrictions-for-insecure-contexts",children:"Restrictions for insecure contexts"}),"\n",(0,r.jsxs)(i.p,{children:['Only \u201csecure origins" as defined in ',(0,r.jsx)(i.a,{href:"https://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features/#definitions",children:"https://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features/#definitions"})," have access to ",(0,r.jsx)(i.code,{children:"window.ethereum"})," and ",(0,r.jsx)(i.code,{children:"window.braveSolana"}),".\nThis can be checked using ",(0,r.jsx)(i.code,{children:"window.isSecureContext"}),", including inside iframes.\nSecure contexts include sites that are served from HTTPS but also HTTP ",(0,r.jsx)(i.code,{children:"localhost"}),"."]}),"\n",(0,r.jsx)(i.h2,{id:"restrictions-in-iframes",children:"Restrictions in iframes"}),"\n",(0,r.jsxs)(i.p,{children:["By default the provider objects are not exposed to 3p iframes.\nBrave exposes 2 new ",(0,r.jsx)(i.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Feature_Policy/Using_Feature_Policy",children:"feature policies"})," for Ethereum and Solana named ",(0,r.jsx)(i.code,{children:"ethereum"})," and ",(0,r.jsx)(i.code,{children:"solana"})," respectively."]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.code,{children:"window.ethereum"})," and ",(0,r.jsx)(i.code,{children:"window.braveSolana"})," are blocked in an iframe if ",(0,r.jsx)(i.code,{children:"window.isSecureContext"})," is ",(0,r.jsx)(i.code,{children:"false"})," in that iframe."]}),"\n",(0,r.jsx)(i.p,{children:"In addition:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["If the iframe is third party to the top-level origin, it will be blocked UNLESS the iframe has the ",(0,r.jsx)(i.code,{children:'allow="{solana/ethereum}"'}),' attribute (where \u201csolana" and \u201cethereum" values control the corresponding API permissions).']}),"\n",(0,r.jsxs)(i.li,{children:["If the iframe is first party to the top-level origin AND the ",(0,r.jsx)(i.code,{children:"sandbox"})," attribute is set on the iframe, it will be blocked UNLESS ",(0,r.jsx)(i.code,{children:'sandbox="allow-same-origin"'}),' is set. Note "allow-same-origin"` does nothing if the iframe is third-party.']}),"\n",(0,r.jsxs)(i.li,{children:["For security-conscious users, we add a setting to block both ",(0,r.jsx)(i.code,{children:"window.ethereum"})," and ",(0,r.jsx)(i.code,{children:"window.solana"})," in ALL iframes, regardless of origin or attributes. This matches the default behavior on iOS."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"ios",children:"iOS"}),"\n",(0,r.jsxs)(i.p,{children:["Currently on iOS, ",(0,r.jsx)(i.code,{children:"window.ethereum"})," and ",(0,r.jsx)(i.code,{children:"window.braveSolana"})," are both undefined in all iframes."]}),"\n",(0,r.jsx)(i.h2,{id:"example-cases",children:"Example cases"}),"\n",(0,r.jsxs)(i.p,{children:["In all these cases, the ",(0,r.jsx)(i.code,{children:"window.ethereum"})," or ",(0,r.jsx)(i.code,{children:"window.braveSolana"})," request is coming from the innermost iframe."]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"http://a.com"})," -> blocked (insecure)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," -> allowed"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="http://a.com/">'})," -> blocked (insecure/3p)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"http://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://a.com/">'})," -> blocked (insecure/3p)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://a.com">'})," -> allowed"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.com">'})," -> blocked (3p)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://b.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="http://a.com/">'})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.com">'})," -> blocked (insecure)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://b.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://a.com">'})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.com">'})," -> blocked (3p)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.a.com">'})," -> blocked (3p)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.a.com" allow="ethereum">'})," -> ethereum allowed, solana blocked"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.com" allow="ethereum">'})," -> ethereum allowed, solana blocked"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.a.com" allow="ethereum; solana">'})," -> ethereum allowed, solana allowed"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://a.com" sandbox>'})," -> blocked (sandbox)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://a.com" sandbox="allow-same-origin allow-scripts">'})," -> allowed (but note this case is discouraged in ",(0,r.jsx)(i.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox",children:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox"})," because it\u2019d allow the iframe to remove its own sandbox attribute)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:'data://foo with <iframe src="data://bar">'})," -> blocked (insecure)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:'file://foo with <iframe src="file://bar">'})," -> blocked (3p)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.com" sandbox="allow-same-origin allow-scripts">'})," -> blocked (3p)"]}),"\n",(0,r.jsxs)(i.li,{children:["Top level ",(0,r.jsx)(i.code,{children:"https://a.com"})," with ",(0,r.jsx)(i.code,{children:'<iframe src="https://b.com" sandbox="allow-scripts" allow="ethereum; solana">'})," -> ethereum allowed, solana allowed"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,n.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,i,s)=>{s.d(i,{R:()=>t,x:()=>c});var o=s(6540);const r={},n=o.createContext(r);function t(e){const i=o.useContext(n);return o.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(n.Provider,{value:i},e.children)}}}]);